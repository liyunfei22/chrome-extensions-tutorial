import{_ as s,c as n,o as a,a as p}from"./app.6667cd43.js";const C=JSON.parse('{"title":"Cross-origin XMLHttpRequest","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u58F0\u660E\u4E3B\u673A\u6743\u9650","slug":"\u58F0\u660E\u4E3B\u673A\u6743\u9650","link":"#\u58F0\u660E\u4E3B\u673A\u6743\u9650","children":[]},{"level":2,"title":"\u53D1\u9001\u8DE8\u57DF\u8BF7\u6C42","slug":"\u53D1\u9001\u8DE8\u57DF\u8BF7\u6C42","link":"#\u53D1\u9001\u8DE8\u57DF\u8BF7\u6C42","children":[]}],"relativePath":"core/Cross-Origin-XHR.md"}'),o={name:"core/Cross-Origin-XHR.md"},l=p(`<h1 id="cross-origin-xmlhttprequest" tabindex="-1">Cross-origin XMLHttpRequest <a class="header-anchor" href="#cross-origin-xmlhttprequest" aria-hidden="true">#</a></h1><p>\u5E38\u89C4\u7F51\u9875\u53EF\u4EE5\u4F7F\u7528 XMLHttpRequest \u5BF9\u8C61\u4ECE\u8FDC\u7A0B\u670D\u52A1\u5668\u53D1\u9001\u548C\u63A5\u6536\u6570\u636E\uFF0C\u4F46\u5B83\u4EEC\u53D7\u5230\u540C\u6E90\u7B56\u7565\u7684\u9650\u5236\u3002</p><p><code>content script</code>\u4EE5\u690D\u5165\u7F51\u9875\u7684\u65B9\u5F0F\u8FD0\u884C\uFF0C\u56E0\u6B64<code>content script</code>\u672C\u4E5F\u53D7\u5236\u4E8E\u76F8\u540C\u7684\u6E90\u7B56\u7565\u3002 \u800C\u6269\u5C55\u7A0B\u5E8F\u7684\u540E\u53F0\u811A\u672C <code>background scripts</code> \u5C31\u4E0D\u53D7\u6B64\u9650\u5236\uFF0C\u53EA\u9700\u8981\u5728\xA0<code>host_permissions</code>\xA0\u4E2D\u58F0\u660E\u540E\u5C31\u53EF\u4EE5\u8BBF\u95EE\u76F8\u5E94\u7684\u8FDC\u7A0B\u670D\u52A1\u5668\uFF1B</p><p>\u5982\u679C\u662F\u901A\u8FC7\xA0<code>fetch()</code>\xA0\u7684\u65B9\u5F0F\u83B7\u53D6\u6269\u5C55\u7A0B\u5E8F\u5185\u90E8\u7684\u9759\u6001\u8D44\u6E90\uFF0C\u5219\u4E0D\u9700\u8981\u58F0\u660E\u6743\u9650\u3002</p><p>\u901A\u8FC7\u5C06\u4E3B\u673A\u6216\u4E3B\u673A\u5339\u914D\u6A21\u5F0F\uFF08\u6216\u4E24\u8005\uFF09\u6DFB\u52A0\u5230\u6E05\u5355\u6587\u4EF6\u7684 host_permissions \u90E8\u5206\uFF0C\u6269\u5C55\u53EF\u4EE5\u8BF7\u6C42\u8BBF\u95EE\u5176\u6E90\u4E4B\u5916\u7684\u8FDC\u7A0B\u670D\u52A1\u5668\u3002</p><h2 id="\u58F0\u660E\u4E3B\u673A\u6743\u9650" tabindex="-1">\u58F0\u660E\u4E3B\u673A\u6743\u9650 <a class="header-anchor" href="#\u58F0\u660E\u4E3B\u673A\u6743\u9650" aria-hidden="true">#</a></h2><div class="language-Javascript"><button title="Copy Code" class="copy"></button><span class="lang">Javascript</span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">My extension</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">host_permissions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: [</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://www.google.com/</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="\u53D1\u9001\u8DE8\u57DF\u8BF7\u6C42" tabindex="-1">\u53D1\u9001\u8DE8\u57DF\u8BF7\u6C42 <a class="header-anchor" href="#\u53D1\u9001\u8DE8\u57DF\u8BF7\u6C42" aria-hidden="true">#</a></h2><p>\u7531\u4E8E\u5185\u5BB9\u811A\u672C <code>content scripts</code> \u53D7\u5230\u540C\u6E90\u653F\u7B56\u7684\u9650\u5236\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4FE1\u606F\u4F20\u9012 <code>message passing</code> \u501F\u52A9\u6269\u5C55\u7A0B\u5E8F\u6765 fetch \u76F8\u5E94\u7684\u670D\u52A1\u5668\u83B7\u53D6\u6570\u636E\u3002</p><p>sendMessage \u4E0E\u540E\u53F0\u811A\u672C\u901A\u4FE1</p><div class="language-Javascript"><button title="Copy Code" class="copy"></button><span class="lang">Javascript</span><pre><code><span class="line"><span style="color:#A6ACCD;">chrome</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">runtime</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sendMessage</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">contentScriptQuery</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">queryPrice</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">itemId</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12345</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#A6ACCD;">price</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u540E\u53F0\u811A\u672C\u8FDB\u884C\u4E8B\u4EF6\u76D1\u542C</p><div class="language-Javascript"><button title="Copy Code" class="copy"></button><span class="lang">Javascript</span><pre><code><span class="line"><span style="color:#A6ACCD;">chrome</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">runtime</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">onMessage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addListener</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">sender</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">sendResponse</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">contentScriptQuery</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">queryPrice</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.google.com/?itemId=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">encodeURIComponent</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">itemId</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">text</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">text</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">parsePrice</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">text</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">price</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sendResponse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">price</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">...</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;">  </span><span style="color:#676E95;">// Will respond asynchronously.</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div>`,13),e=[l];function t(c,r,F,y,D,i){return a(),n("div",null,e)}const d=s(o,[["render",t]]);export{C as __pageData,d as default};
